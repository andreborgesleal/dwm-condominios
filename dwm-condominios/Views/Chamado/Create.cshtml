@using App_Dominio.Repositories
@using DWM.Models.Repositories
@model ChamadoViewModel
@{
    TransacaoRepository[] t = { new TransacaoRepository(), new TransacaoRepository() };
    t[0].url = "../Chamado/Browse";
    t[0].nomeCurto = "Incluir";
    t[0].referencia = "";

    t[1].url = "../Home/Default";
    ViewBag.empresaId = Model.CondominioID;
}
<div class="container-cadastro">
    @if (!Model.IsFornecedor && !Model.CondominoID.HasValue)
    {
        <div class="row">
            <div class="col-md-12 col-lg-12 col-xs-12 col-sm-12">
                @Html.Partial("../Condomino/Search", Model.Condominos)
            </div>
        </div>
    }
    <div class="x_panel">
        @Html.EditorFor(info => Model, "FORMULARIO", new { Brand = "Chamado", Descricao = "", Transacao = t })
        <div class="x_content">
            @using (Html.BeginForm("Create", "Chamado", FormMethod.Post, new { @class = "form-horizontal" }))
            {
                @Html.ValidationSummary("", new { @class = "text-danger" })
                @Html.HiddenFor(info => info.CondominioID)
                @Html.HiddenFor(info => info.empresaId)

                <input type="hidden" id="__EdificacaoID" name="__EdificacaoID" />
                <input type="hidden" id="__UnidadeID" name="__UnidadeID" />
                <input type="hidden" id="__CondominoID" name="__CondominoID" />

                <div class="row">
                    <div class="col-md-8 col-sm-12 col-lg-8 col-xs-12">
                        <div class="form-group">
                            <label class="control-label">Assunto</label>
                            <input type="text" class="form-control" name="Assunto" id="Assunto" value="@Model.Assunto" />
                        </div>
                    </div>
                    <div class="col-md-4 col-lg-4 col-xs-12 col-sm-12">
                        <div class="form-group">
                            <label class="control-label">Motivo</label>
                            @Html.DropDownList("ChamadoMotivoID", new DWM.Models.Enumeracoes.BindDropDownList().ChamadoMotivos("Selecione...", Model.ChamadoMotivoID), new { @class = "form-control" })
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 col-sm-12 col-lg-6 col-xs-12">
                        <div class="form-group">
                            <label class="control-label">Solicitante</label>
                            @Html.DropDownList("FilaSolicitanteID", new DWM.Models.Enumeracoes.BindDropDownList().FilaSolicitante("Selecione...", Model.FilaSolicitanteID), new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-6 col-xs-12 col-sm-12">
                        <div class="form-group">
                            <label class="control-label">Fila de atendimento</label>
                            @Html.DropDownList("FilaAtendimentoID", new DWM.Models.Enumeracoes.BindDropDownList().Filas("Selecione...", Model.FilaAtendimentoID ?? 0), new { @class = "form-control" })
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-lg-12 col-xs-12">
                        <div class="form-group">
                            <label class="control-label">Mensagem</label>
                            <input type="hidden" name="MensagemOriginal" id="MensagemOriginal" value="@Model.MensagemOriginal" />
                            <div id="summernote1">@Model.MensagemOriginal</div>
                        </div>
                    </div>
                </div>
                <hr />
                <div class="row">
                    <div class="col-md-12">
                        <input type="submit" value="Salvar" class="btn btn-primary" onclick="return Valida();" />
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<script>
    var _indice = -1;
    var _CondominoID;
    var _EdificacaoID;
    var _UnidadeID;

    $(document).ready(function () {
        $('#summernote1').summernote({
            lang: 'pt-BR',
            height: 250,
            //toolbar: [
            //   // [groupName, [list of button]]
            //   ['style', ['bold', 'italic', 'underline', 'clear']],
            //   ['font', ['strikethrough', 'superscript', 'subscript']],
            //   ['fontsize', ['fontsize']],
            //   ['color', ['color']],
            //   ['para', ['ul', 'ol', 'paragraph']],
            //   ['height', ['height']]
            //]
        });
        $('#MensagemOriginal').html('@Model.MensagemOriginal');
        $('#summernote1').summernote('code', $('#MensagemOriginal').val());
    });

    function Valida() {
        $('#MensagemOriginal').val($('#summernote1').summernote('code'));
        $('#__EdificacaoID').val(_EdificacaoID);
        $('#__UnidadeID').val(_UnidadeID);
        $('#__CondominoID').val(_CondominoID);

        return false;
    }

    function getEmail() {
        var _EmailTemplateID = $('#EmailTemplateID').val();
        var _CondominioID = $('#CondominioID').val();
        if (_EmailTemplateID != '' && _EmailTemplateID != '0') {
            var link = "GetNamesEmailTemplate?EmailTemplateID=" + _EmailTemplateID;
            link = encodeURI(link + '&noCahce=' + new Date());
            $.ajax({
                type: "POST",
                url: link,
                contentType: "application/json; charset=utf-8",
                global: false,
                async: false,
                dataType: "json",
                success: function (jsonObj) {
                    $('#summernote1').summernote('code', jsonObj.EmailMensagem);
                    $('#EmailMensagem').val($('#summernote1').summernote('code'));
                }
            });
        }
    }
</script>