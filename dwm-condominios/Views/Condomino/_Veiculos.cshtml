@using App_Dominio.Repositories
@using DWM.Models.Repositories
@model CondominoEditViewModel
@{
    Layout = null;
    TransacaoRepository[] t = { new TransacaoRepository(), new TransacaoRepository() };
    t[0].url = "#";
    t[0].nomeCurto = "Incluir";
    t[0].referencia = "insVei(" + Model.VeiculoViewModel.CondominioID + ", " + Model.VeiculoViewModel.EdificacaoID + ", " + Model.VeiculoViewModel.UnidadeID + ", " + Model.VeiculoViewModel.CondominoID + ", '','','','','')";
    t[0].exibir = "S";

    t[1].url = "../Home/Default";

    TransacaoRepository[] t1 = { new TransacaoRepository(), new TransacaoRepository() };
    t1[0].url = "../Condomino/Browse";
    t1[0].nomeCurto = "Veículo";
    t1[0].referencia = "";
    t1[0].exibir = "N";

    t1[1].url = "../Home/Default";
}

@if (Model != null)
{
    if (Model.Veiculos.Count() > 0)
    {
        <table class="table table-striped hidden-xs" id="cad-vei">
            <thead>
                <tr>
                    <th>Placa</th>
                    <th>Descrição</th>
                    <th>Marca</th>
                    <th>Cor</th>
                    <th>Condutor</th>
                    <th>Ação</th>
                </tr>
            </thead>
            <tbody>
                @{
                    foreach (VeiculoViewModel vei in Model.Veiculos)
                    {
                        <tr>
                            <td><small>@vei.Placa</small></td>
                            <td><small>@vei.Descricao</small></td>
                            <td><small>@vei.Marca</small></td>
                            <td><small>@vei.Cor</small></td>
                            <td><small>@vei.Condutor</small></td>
                            <th scope="row">
                                <a href="#cad-vei" title="Editar" onclick="editVei('@vei.CondominioID', '@vei.EdificacaoID', '@vei.UnidadeID','@vei.CondominoID','@vei.Placa', '@vei.Descricao', '@vei.Marca', '@vei.Cor', '@vei.Condutor')"><i class="fa fa-edit"></i></a>
                                <a href="#cad-vei" title="Excluir" onclick="delVei('@vei.CondominioID', '@vei.EdificacaoID', '@vei.UnidadeID','@vei.CondominoID','@vei.Placa', '@vei.Descricao', '@vei.Marca', '@vei.Cor', '@vei.Condutor')"><i class="fa fa-trash"></i></a>
                            </th>
                        </tr>
                    }
                }
            </tbody>
        </table>
        <!-- Mobile -->
        <table class="table table-striped hidden-lg hidden-md hidden-sm">
            <tbody>
                @{
                    foreach (VeiculoViewModel vei in Model.Veiculos)
                    {
                        <tr>
                            <td>
                                <p>
                                    <span class="h4">@vei.Placa</span><small class="pull-right">@vei.Marca</small>
                                </p>
                                <small>@vei.Descricao</small>
                                <small>@vei.Cor</small>
                                <p>Condutor: <strong>@vei.Condutor</strong></p>
                                <p>&nbsp;</p>
                                <a href="#vei" title="Editar" onclick="editVei('@vei.CondominioID', '@vei.EdificacaoID', '@vei.UnidadeID','@vei.CondominoID','@vei.Placa', '@vei.Descricao', '@vei.Marca', '@vei.Cor', '@vei.Condutor')"><i class="fa fa-2x fa-edit"></i></a>
                                <a href="#vei" title="Excluir" onclick="delVei('@vei.CondominioID', '@vei.EdificacaoID', '@vei.UnidadeID','@vei.CondominoID','@vei.Placa', '@vei.Descricao', '@vei.Marca', '@vei.Cor', '@vei.Condutor')"><i class="fa fa-2x fa-trash"></i></a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    }
    <div class="x_panel" id="vei">
         @Html.EditorFor(info => Model, "FORMULARIO", new { Brand = "Veículo", Descricao = "", Transacao = t1 })
         <div class="x_content">
            @using (Ajax.BeginForm("EditVeiculo", "Condomino", new AjaxOptions { HttpMethod = "GET", UpdateTargetId = "div-veiculos" }, new { @class = "form", @id = "form003", @name = "form003" }))
            {
                @Html.Partial("_alerts")
                @Html.ValidationSummary("", new { @class = "text-danger" })
                @Html.HiddenFor(info => info.VeiculoViewModel.CondominioID)
                @Html.HiddenFor(info => info.VeiculoViewModel.EdificacaoID)
                @Html.HiddenFor(info => info.VeiculoViewModel.UnidadeID)
                @Html.HiddenFor(info => info.VeiculoViewModel.CondominoID)
                @Html.Hidden("OperacaoVei", "I")
                <div class="row">
                    <div class="col-md-3 col-xs-12 col-sm-12 col-lg-3">
                        <div class="form-group">
                            @Html.LabelFor(m => m.VeiculoViewModel.Placa, new { @class = "control-label" })
                            <input type="text" class="form-control text-uppercase" name="VeiculoViewModel.Placa" id="VeiculoViewModel_Placa" value="@Model.VeiculoViewModel.Placa" maxlength="7" />
                        </div>
                    </div>
                    <div class="col-md-6 col-xs-12 col-sm-12 col-lg-6">
                        <div class="form-group">
                            @Html.LabelFor(m => m.VeiculoViewModel.Descricao, new { @class = "control-label" })
                            <input type="text" class="form-control" name="VeiculoViewModel.Descricao" id="VeiculoViewModel_Descricao" value="@Model.VeiculoViewModel.Descricao" maxlength="20" placeholder="Ex: GOL GT, Celta LX" />
                        </div>
                    </div>
                    <div class="col-md-3 col-xs-12 col-sm-12 col-lg-3">
                        <div class="form-group">
                            @Html.LabelFor(m => m.VeiculoViewModel.Marca, new { @class = "control-label" })
                            <input type="text" class="form-control" name="VeiculoViewModel.Marca" id="VeiculoViewModel_Marca" value="@Model.VeiculoViewModel.Marca" maxlength="20" placeholder="Ex: Chevrolet" />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3 col-xs-12 col-sm-12 col-lg-3">
                        <div class="form-group">
                            @Html.LabelFor(m => m.VeiculoViewModel.Cor, new { @class = "control-label" })
                            <input type="text" class="form-control" name="VeiculoViewModel.Cor" id="VeiculoViewModel_Cor" value="@Model.VeiculoViewModel.Cor" maxlength="15" />
                        </div>
                    </div>
                    <div class="col-md-6 col-xs-12 col-sm-12 col-lg-6">
                        <div class="form-group">
                            @Html.LabelFor(m => m.VeiculoViewModel.Condutor, new { @class = "control-label" })
                            <input type="text" class="form-control" name="VeiculoViewModel.Condutor" id="VeiculoViewModel_Condutor" value="@Model.VeiculoViewModel.Condutor" maxlength="40" />
                        </div>
                    </div>
                </div>
                <p>&nbsp;</p>
                <div class="row clearfix">
                    <div class="col-md-12">
                        <div class="form-group">
                            <input type="submit" class="btn btn-success" value="Salvar" name="btn-salvar-veiculo" id="btn-salvar-veiculo" onclick="$('#msg-salvando-vei').show()"/>
                            <input type="button" onclick="insVei(@(Model.VeiculoViewModel.CondominioID), @(Model.VeiculoViewModel.EdificacaoID),@(Model.VeiculoViewModel.UnidadeID),@(Model.VeiculoViewModel.CondominoID), '','','','','')" class="btn btn-default" value="Cancelar" />
                            <span class="text-prateado" id="msg-salvando-vei">Salvando...</span>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
}
else
{
    @Html.Partial("_AcessoNegadoModal")
}

<script type="text/javascript">
    $('#msg-salvando-vei').hide()
    $("#OperacaoVei").val("I");
    $("#VeiculoViewModel_Placa").attr('readonly', false);

    $(function () {
        $('#form003').submit(function () {
            if ($(this).valid()) {
                $.ajax({
                    url: this.action,
                    type: this.method,
                    data: $(this).serialize(),
                    success: function (result) {
                        $('#div-veiculos').html(result);
                    }
                });
            }
            return false;
        });
    });

    function fillVei(CondominioID, EdificacaoID, UnidadeID, CondominoID, Placa, Descricao, Marca, Cor, Condutor) {
        $("#VeiculoViewModel_CondominioID").val(CondominioID);
        $("#VeiculoViewModel_EdificacaoID").val(EdificacaoID);
        $("#VeiculoViewModel_UnidadeID").val(UnidadeID);
        $("#VeiculoViewModel_CondominoID").val(CondominoID);
        $("#VeiculoViewModel_Placa").val(Placa);
        $("#VeiculoViewModel_Descricao").val(Descricao);
        $("#VeiculoViewModel_Marca").val(Marca);
        $("#VeiculoViewModel_Cor").val(Cor);
        $("#VeiculoViewModel_Condutor").val(Condutor);
    }

    function changeBtnClassVei(oldClas, newClass, oper) {
        $("#OperacaoVei").val(oper); // I-Incluir, S-Salvar (alterar) ou D-Deletar
        if (oper == 'S') {
            $('#header-veiculo').html('Alterar veículo <small>Alteração de veículos do condômino.</small>');
            $("#btn-salvar-veiculo").val("Salvar");
        }
        else if (oper == 'I') {
            $('#header-veiculo').html('Novo veículo <small>O novo veículo será habilitado pela admministração p/acesso ao condomínio.</small>');
            $("#btn-salvar-veiculo").val("Salvar");
        }
        else {
            $('#header-veiculo').html('Excluir veículo <small>Exclusão do veículo.</small>');
            $("#btn-salvar-veiculo").val("Excluir");
        }
        $("#btn-salvar-veiculo").removeClass(oldClas);
        $("#btn-salvar-veiculo").addClass(newClass);
    }

    function insVei(CondominioID, EdificacaoID, UnidadeID, CondominoID, Placa, Descricao, Marca, Cor, Condutor) {
        fillVei(CondominioID, EdificacaoID, UnidadeID, CondominoID, '', '', '', '', '');
        changeBtnClassVei('btn btn-danger', 'btn btn-success', 'I');
        $("#VeiculoViewModel_Placa").attr('readonly', false);
    }

    function editVei(CondominioID, EdificacaoID, UnidadeID, CondominoID, Placa, Descricao, Marca, Cor, Condutor) {
        fillVei(CondominioID, EdificacaoID, UnidadeID, CondominoID, Placa, Descricao, Marca, Cor, Condutor)
        changeBtnClassVei('btn btn-danger', 'btn btn-success', 'S')
        $("#VeiculoViewModel_Placa").attr('readonly', true);
    }

    function delVei(CondominioID, EdificacaoID, UnidadeID, CondominoID, Placa, Descricao, Marca, Cor, Condutor) {
        fillVei(CondominioID, EdificacaoID, UnidadeID, CondominoID, Placa, Descricao, Marca, Cor, Condutor)
        changeBtnClassVei('btn btn-success', 'btn btn-danger', 'D')
        $("#VeiculoViewModel_Placa").attr('readonly', true);
    }
</script>
